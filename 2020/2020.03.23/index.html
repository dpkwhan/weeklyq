



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="weekly q">
      
      
        <link rel="canonical" href="https://dpkwhan.github.io/weeklyq/2020/2020.03.23/">
      
      
        <meta name="author" content="David Han">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/img/logo.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.3">
    
    
      
        <title>2020.03.23 - weekly q</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../assets/css/extra.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/themes/prism-solarizedlight.min.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-140259656-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="deep-orange">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#introduction" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://dpkwhan.github.io/weeklyq/" title="weekly q" aria-label="weekly q" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="../../assets/img/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              weekly q
            </span>
            <span class="md-header-nav__topic">
              
                2020.03.23
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../2020.05.11/" class="md-tabs__link md-tabs__link--active">
          2020
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://dpkwhan.github.io/weeklyq/" title="weekly q" class="md-nav__button md-logo">
      
        <img alt="logo" src="../../assets/img/logo.png" width="48" height="48">
      
    </a>
    weekly q
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      2020
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        2020
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.05.11/" title="2020.05.11" class="md-nav__link">
      2020.05.11
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.05.04/" title="2020.05.04" class="md-nav__link">
      2020.05.04
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.04.27/" title="2020.04.27" class="md-nav__link">
      2020.04.27
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.04.20/" title="2020.04.20" class="md-nav__link">
      2020.04.20
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.04.13/" title="2020.04.13" class="md-nav__link">
      2020.04.13
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.04.06/" title="2020.04.06" class="md-nav__link">
      2020.04.06
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.03.30/" title="2020.03.30" class="md-nav__link">
      2020.03.30
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        2020.03.23
      </label>
    
    <a href="./" title="2020.03.23" class="md-nav__link md-nav__link--active">
      2020.03.23
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#question" class="md-nav__link">
    Question
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#answer" class="md-nav__link">
    Answer
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-each-both" class="md-nav__link">
    Use each both
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-where-and-any" class="md-nav__link">
    Use where and any
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-list-argument" class="md-nav__link">
    Use list argument
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-operator-apply" class="md-nav__link">
    Use operator apply .
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.03.16/" title="2020.03.16" class="md-nav__link">
      2020.03.16
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.03.09/" title="2020.03.09" class="md-nav__link">
      2020.03.09
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.03.02/" title="2020.03.02" class="md-nav__link">
      2020.03.02
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.02.24/" title="2020.02.24" class="md-nav__link">
      2020.02.24
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.02.17/" title="2020.02.17" class="md-nav__link">
      2020.02.17
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.02.10/" title="2020.02.10" class="md-nav__link">
      2020.02.10
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.02.03/" title="2020.02.03" class="md-nav__link">
      2020.02.03
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.01.27/" title="2020.01.27" class="md-nav__link">
      2020.01.27
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.01.20/" title="2020.01.20" class="md-nav__link">
      2020.01.20
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.01.13/" title="2020.01.13" class="md-nav__link">
      2020.01.13
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020.01.06/" title="2020.01.06" class="md-nav__link">
      2020.01.06
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#question" class="md-nav__link">
    Question
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#answer" class="md-nav__link">
    Answer
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-each-both" class="md-nav__link">
    Use each both
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-where-and-any" class="md-nav__link">
    Use where and any
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-list-argument" class="md-nav__link">
    Use list argument
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-operator-apply" class="md-nav__link">
    Use operator apply .
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>2020.03.23</h1>
                
                <p><span style="display:block;text-align:center">
<img alt="Query" src="../../assets/img/2020.03.23.png" />
</span>
<span style="display:block;text-align:center"><font color="grey">Source: </font>adopted from <a href="https://www.iso20022.org/market-identifier-codes">here</a></span></p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Market Identifier Code (MIC) is an international standard, which "specifies a universal method of identifying exchanges, trading platforms, regulated or non-regulated markets and trade reporting facilities as sources of prices and related information in order to facilitate automated processing" as quoted from its <a href="https://www.iso20022.org/market-identifier-codes">official site</a>.</p>
<p>The U.S. Equities market has 13 lit exchanges and dozens of Alternative Trading Systems (ATSs), <em>a.k.a.</em> dark pools. Many buy side firms also operate their own non-ATS crossing systems.</p>
<h2 id="question">Question<a class="headerlink" href="#question" title="Permanent link">&para;</a></h2>
<p>There might be multiple exchanges quoting at the National Best Bid and Offer (NBBO) price level at any given time. It is assumed that child orders are always placed at NBBO and can be placed to any lit exchanges. The below function <code>simChildOrders</code> simulates some <strong>BUY</strong> orders with execution destination (<code>exDest</code>). See the definition of FIX tag for <a href="https://fiximate.fixtrading.org/en/FIX.5.0SP2_EP255/tag100.html">exDest</a>. It also has a column <code>nbbExchanges</code>, which shows the list of lit exchanges that are present at the best bid price level.</p>
<pre><code class="q">simChildOrders:{[nOrders]
    seed:-314159;
    openTime:`time$09:30;
    closeTime:`time$16:00;
    litVenues:`XNYS`ARCX`XCHI`XASE`XCIS`XNAS`XBOS`XPHL`BATS`BATY`EDGA`EDGX`IEXG;

    system &quot;S &quot;,string seed;
    submitTimes:asc closeTime&amp;openTime+nOrders?390*60*1000;

    system &quot;S &quot;,string seed;
    exDest:nOrders?litVenues;

    system &quot;S &quot;,string seed;
    nExchanges:3+nOrders?(count litVenues)-3;
    system &quot;S &quot;,string seed;
    nbbVenues:{y?x}[litVenues;] each nExchanges;

    ([] time:submitTimes;side:`BUY;exDest:exDest;nbbVenues:nbbVenues)
  };

childOrders:simChildOrders[5000];
</code></pre>

<p>Find the number of orders which are placed to exchanges present at NBB (National Best Bid).</p>
<h2 id="answer">Answer<a class="headerlink" href="#answer" title="Permanent link">&para;</a></h2>
<h3 id="use-each-both">Use each both<a class="headerlink" href="#use-each-both" title="Permanent link">&para;</a></h3>
<p>Learn more about <code>each</code> or <code>each both</code> <a href="https://code.kx.com/q/ref/maps/#each">here</a>.</p>
<pre><code class="q">exec sum in'[exDest;nbbVenues] from childOrders
</code></pre>

<p>Each applied to a binary value is also called each both and the infix form can be used.</p>
<pre><code class="q">exec sum exDest in' nbbVenues from childOrders
</code></pre>

<h3 id="use-where-and-any">Use <code>where</code> and <code>any</code><a class="headerlink" href="#use-where-and-any" title="Permanent link">&para;</a></h3>
<pre><code class="q">exec count i from childOrders where any each exDest=nbbVenues
</code></pre>

<h3 id="use-list-argument">Use list argument<a class="headerlink" href="#use-list-argument" title="Permanent link">&para;</a></h3>
<p>Note that the anonymous function is unary and the parameter is a list.</p>
<pre><code class="q">exec sum {x[0] in x[1]} each flip (exDest;nbbVenues) from childOrders
</code></pre>

<h3 id="use-operator-apply">Use operator apply <code>.</code><a class="headerlink" href="#use-operator-apply" title="Permanent link">&para;</a></h3>
<p>The operator apply <code>.</code> applies a function to a list and use the individual list elements as the arguments to the function. This is very much similar to <code>*</code> operator to unpack argument list to function call in <a href="https://docs.python.org/3.9/tutorial/controlflow.html#unpacking-argument-lists">Python</a> and the spread operator <code>...</code> in <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax">JavaScript</a>.</p>
<pre><code class="q">exec sum ({x in y}.) each flip (exDest;nbbVenues) from childOrders
</code></pre>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../2020.03.30/" title="2020.03.30" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                2020.03.30
              </span>
            </div>
          </a>
        
        
          <a href="../2020.03.16/" title="2020.03.16" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                2020.03.16
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 David Han. A written permission is required for reproduction.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
      
        <script src="https://tracker.mrpfd.com/tracker.js"></script>
      
        <script src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"></script>
      
        <script src="../../assets/js/theme.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.4.0/clipboard.min.js"></script>
      
        <script src="../../assets/js/prism.js"></script>
      
    
  </body>
</html>